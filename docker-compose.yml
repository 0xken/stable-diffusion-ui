version: '3.3'

services:
  stability-ai:
    container_name: sd
    ports:
      - '5000:5000'
    image: 'r8.im/andreasjansson/stable-diffusion-wip@sha256:984cf13f8875bf9eec0860e87ce41143f40b6f07f0112505c6833147763353ad'
    deploy:
      resources:
        reservations:
          devices:
            - capabilities: [gpu]

  stable-diffusion-ui:
    container_name: sd-ui
    ports:
      - '8000:8000'
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - .:/app
    depends_on:
      - stability-ai

networks:
  default: